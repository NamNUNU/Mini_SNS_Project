<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../css/style.css">
  </head>
  <body>
    <div class="wrap">
      <div class="container">
        <div class="content">
          <article>
            <div class="img-wrap">

            </div>
            <div class="login-wrap">
              <div class="login-form">
                <h1 class="brand-name">Codestargram</h1>
                <form class="login-port" action="index.html" method="post">
                  <input type="text" name="email"><br>
                  <input type="password" name="pw">
                </form>
                <button class="login-btn ajaxsend" type="button">로그인</button>
                <div class="login-join-form">
                  <p>계정이 없으신가요? <a href="/join">가입하기</a></p>
                </div>
                <div class="result"></div>
              </div>
            </div>
          <article>
        </div>
      </div>
      <footer class="footer-wrap">
        <div class="footer-content">
          <p class="copy">정보 지원 블로그 관련 기사 채용정보 개인정보 처리방침</p>
        </div>
      </footer>
    </div>
    <script type="text/javascript">
      document.querySelector('.ajaxsend').addEventListener('click', function(){
        var email =  document.getElementsByName('email')[0].value;
        var password =  document.getElementsByName('pw')[0].value;
        sendAjax('http://localhost:3000/login',{'email': email, 'pw':password});
      })

      function sendAjax(url, data){
        data = JSON.stringify(data);

        var oReq = new XMLHttpRequest();
        oReq.open('POST', url);
        oReq.setRequestHeader('Content-Type', 'application/json')
        oReq.send(data);


        oReq.addEventListener('load', function(){
          var result = JSON.parse(oReq.responseText);
          console.log(data, result);
          var resultDiv = document.querySelector('.result');

          if(result.email) {
            resultDiv.innerHTML = 'welcome '+ result.email +'!!'
            window.location.href = '/main'
          }
          else if(oReq.status === 400){
            resultDiv.innerHTML = result + "<div class='sign up'><a href='/join'>Sign up</a></div>"
          }
          else resultDiv.innerHTML =  result;
        });
      }
    </script>
  </body>
</html>
